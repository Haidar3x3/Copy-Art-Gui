local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")

-- ===== CONFIGURATION =====
local CONFIG = {
    DURATIONS = {
        INITIAL_BLACK = 5,  
        STAR_APPEAR = 7,    
        MAIN_TRANSITION = 23,
        FINAL_FLASH = 2,     
        TEXT_FADE_OUT = 3,   
        FINAL_BLACKOUT = 2.5 
    },
    
    ASSETS = {
        STAR = "rbxassetid://95455071788705"
    },
    
    STAR_SIZE = {
        START = 10,
        MID = 300,
        END = 350
    },
    
    TEXT_SEQUENCE = {
        {text = "HEY", delay = 1, duration = 2, fade = 0.5},
        {text = "I GAVE YOU MY POWER", delay = 1, duration = 3, fade = 0.5},
        {text = "NOW WAKE UP", delay = 1, duration = 3, fade = 0.5},
        {text = "SLOWLY", delay = 0, duration = 15, fade = 3}
    }
}

local TEXT_FONT = Enum.Font.FredokaOne -- Closest to Frijole in Roblox

-- ===== SCREEN SETUP =====
local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

local transitionGui = Instance.new("ScreenGui")
transitionGui.Name = "FinalCutscene"
transitionGui.IgnoreGuiInset = true
transitionGui.ResetOnSpawn = false
transitionGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
transitionGui.Parent = playerGui

local blackFrame = Instance.new("Frame")
blackFrame.Size = UDim2.new(1, 0, 1, 0)
blackFrame.BackgroundColor3 = Color3.new(0, 0, 0)
blackFrame.BackgroundTransparency = 0
blackFrame.ZIndex = 2
blackFrame.Parent = transitionGui

local star = Instance.new("ImageLabel")
star.Size = UDim2.new(0, CONFIG.STAR_SIZE.START, 0, CONFIG.STAR_SIZE.START)
star.Position = UDim2.new(0.5, 0, 0.5, 0)
star.AnchorPoint = Vector2.new(0.5, 0.5)
star.BackgroundTransparency = 1
star.Image = CONFIG.ASSETS.STAR
star.ImageTransparency = 1
star.ZIndex = 3
star.Parent = transitionGui

local textGui = Instance.new("ScreenGui")
textGui.Name = "TextAnimations"
textGui.ResetOnSpawn = false
textGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
textGui.Parent = playerGui

local function createText(text, config)
    local textLabel = Instance.new("TextLabel")
    textLabel.Size = UDim2.new(0, 600, 0, 80)
    textLabel.Position = UDim2.new(0.5, 0, 0.5, 0)
    textLabel.AnchorPoint = Vector2.new(0.5, 0.5)
    textLabel.BackgroundTransparency = 1
    textLabel.Text = ""
    textLabel.TextColor3 = Color3.new(1, 1, 1)
    textLabel.TextSize = 42
    textLabel.Font = TEXT_FONT
    textLabel.TextTransparency = 1
    textLabel.ZIndex = 10
    textLabel.Parent = textGui

    task.wait(config.delay)
    
    local fadeIn = TweenService:Create(textLabel, TweenInfo.new(0.5), {
        TextTransparency = 0
    })
    fadeIn:Play()
    
    for i = 1, #text do
        textLabel.Text = string.sub(text, 1, i)
        task.wait(0.07)
    end

    task.wait(config.duration)

    local fadeOut = TweenService:Create(textLabel, TweenInfo.new(config.fade), {
        TextTransparency = 1
    })
    fadeOut:Play()
    fadeOut.Completed:Wait()
    
    textLabel:Destroy()
end

local function runTransition()
    task.wait(CONFIG.DURATIONS.INITIAL_BLACK)

    task.spawn(function()
        for _, textConfig in ipairs(CONFIG.TEXT_SEQUENCE) do
            createText(textConfig.text, textConfig)
        end
    end)

    -- Keep the black screen until STAR_APPEAR is complete
    task.wait(CONFIG.DURATIONS.STAR_APPEAR)

    -- Start fading black screen during the MAIN_TRANSITION phase
    local fadeBlack = TweenService:Create(blackFrame, TweenInfo.new(CONFIG.DURATIONS.MAIN_TRANSITION), {
        BackgroundTransparency = 0.8
    })
    fadeBlack:Play()

    task.wait(CONFIG.DURATIONS.MAIN_TRANSITION)

    -- FINAL FLASH (2s)
    local flash = Instance.new("Frame")
    flash.Size = UDim2.new(1, 0, 1, 0)
    flash.BackgroundColor3 = Color3.new(1, 1, 1)
    flash.BackgroundTransparency = 1
    flash.ZIndex = 20
    flash.Parent = transitionGui

    local flashIn = TweenService:Create(flash, TweenInfo.new(1), {
        BackgroundTransparency = 0
    })
    flashIn:Play()
    flashIn.Completed:Wait()

    local flashOut = TweenService:Create(flash, TweenInfo.new(1), {
        BackgroundTransparency = 1
    })
    flashOut:Play()
    flashOut.Completed:Wait()
    flash:Destroy()

    task.wait(CONFIG.DURATIONS.FINAL_BLACKOUT)
    
    local finalBlackFrame = Instance.new("Frame")
    finalBlackFrame.Size = UDim2.new(1, 0, 1, 0)
    finalBlackFrame.BackgroundColor3 = Color3.new(0, 0, 0)
    finalBlackFrame.BackgroundTransparency = 1
    finalBlackFrame.ZIndex = 100
    finalBlackFrame.Parent = transitionGui

    local blackout = TweenService:Create(finalBlackFrame, TweenInfo.new(0.5), {
        BackgroundTransparency = 0
    })
    blackout:Play()
    blackout.Completed:Wait()

    transitionGui:Destroy()
    textGui:Destroy()
end

runTransition()
